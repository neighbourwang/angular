<fc-notice #notice ot="确认"></fc-notice>
<div class="OrderManage">	
	<div class="page-content-header icon-order-manage" style="border-bottom: 3px solid  #01a982;margin: 10px 0px;padding: 0;">已订购管理</div>
		<div class="page-content">
			<div class="table-container">
				<div class="search-container">
					<input type="text" class="form-control searchbox gray-searchbox" placeholder=""  [(ngModel)]="_param.queryParam"/>
					<span class="glyphicon glyphicon-search searchbox-incon" (click)="search()"></span>
							
					<button class=" form-control-title fox-cloud-button  fox-cloud-button-green left" (click)="_param.reset()">重&nbsp;&nbsp;&nbsp;&nbsp;置</button>
				</div>
				<table class="table">
					<tbody>
						<tr>				
							<td >
								<div class="left form-control-title">企&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业：</div>
								
								<div class="dropdown left">
									<select class="form-control" [(ngModel)]="_param.enterpriseId" (ngModelChange)="loadDepartment()">
										<option class="hands" [value]="null" >订购人</option>
										<option *ngFor="let item of _adminLoader.Items" class="hands" [value]="item.id">{{item.name}}</option>
									</select>
								</div>
							</td>
							<td colspan="3"><div class="left form-control-title" >部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门:</div>
								<div class="dropdown left">
									<select class="form-control" [(ngModel)]="_param.organization">
										<option class="hands" [value]="null">所有部门</option>
										<option class="hands" *ngFor="let item of _departmentLoader.Items" [value]="item.id">{{item.name}}</option>
									</select>
								</div>
							</td>
						</tr>
						<tr>
							<td ><div class="left form-control-title">创建时间：</div>
								<div class="dropdown left">	
									<date-picker (dateChanged)="onCreateTimeChange($event)"></date-picker>
									<!-- <input type="text" [(ngModel)]='_param.createTime'/> -->
								</div>
							</td>
							<td colspan="3"><div class="left form-control-title">到期时间：</div>
								<div class="dropdown left">			
									<date-picker (dateChanged)="onExpireTimeChange($event)"></date-picker>
									<!-- <input type="text" [(ngModel)]='_param.expireTime'/> -->
								</div>
							</td>
						</tr>
						<tr>
							<td><div class="left form-control-title">订单状态：</div>
								<div class="dropdown left">
									<select class="form-control" [(ngModel)]="_param.status">
										<option class="hands" [value]="null">所有</option>
										<option class="hands" *ngFor="let item of _orderStatus.Items" [value]="item.value">{{item.displayValue}}</option>
									</select>
								</div>
							</td>
							<td ><div class="left form-control-title">产品类型：</div>
								<div class="dropdown left">
									<select class="form-control" [(ngModel)]="_param.serviceType">
										<option class="hands" [value]="null">所有类型</option>
										<option class="hands" *ngFor="let item of _productTypeLoader.Items" [value]="item.value">{{item.displayValue}}</option>
									</select>
								</div>
							</td>
							<td ><div class="left form-control-title">区域：</div>
								<div class="dropdown left">
									<select class="form-control" [(ngModel)]="_param.platformId" (ngModelChange)="loadSubregion()">
										<option class="hands" [value]="null">所有</option>
										<option class="hands" *ngFor="let item of _platformLoader.Items" [value]="item.id">{{item.name}}</option>
									</select>
								</div>
							</td>
							<td ><div class="left form-control-title">可用区：</div>
								<div class="dropdown left">
									<select class="form-control" [(ngModel)]="_param.zoneId">
										<option class="hands" [value]="null">所有</option>
										<option class="hands" *ngFor="let item of _subregionLoader.Items" [value]="item.zoneId">{{item.zoneName}}</option>
									</select>
								</div>
							</td>
						</tr>
					</tbody>
				</table>	
			</div>
			<div class="page-second-title" style="border:none;">当查询到{{_orderLoader.Items.length}}个订单需要审批，查询列表如下：</div>
				<div class="table-container">
				<table class="table">
					<thead>	
						<tr class="form-control-title" >
							<th class="order-title"> 产品名称</th>
							<th>计费模式</th>
							<th>购买周期</th>
							<th>数量</th>
							<th style="width: 150px;">单价费用</th>
							<th>产品类型</th>
							<th>状态</th>
							<th>创建时间</th>
							<th>到期时间</th>
						</tr>			
					</thead>
				</table>

				<table class="table _table" *ngFor="let orderItem of _orderLoader.Items">
					<tr>
						<td class="order-title" colspan="7">{{orderItem.purchaseDate}} 订单号：{{orderItem.orderNo}}</td>
						
						<td><button class="fox-cloud-button  fox-cloud-button-green pull-right"  data-toggle="modal" data-target="#renewOrder" (click)="renewSelect(orderItem)">续&nbsp;&nbsp;&nbsp;订</button></td>
						<td><button class="fox-cloud-button  fox-cloud-button-green  pull-right"  (click)="showDetail(orderItem.orderId)">详&nbsp;&nbsp;&nbsp;情</button></td>
					</tr>
					<tr *ngFor="let prodItem of orderItem.itemList">
						<td style="text-align: left;padding-top: 30px;padding-left: 40px;width:220px!important; ">
							<ul>
								<li *ngFor="let detailItem of prodItem.specList">{{detailItem.attrDisplayName}}：&nbsp;&nbsp;{{detailItem.attrDisplayValue}} {{detailItem.valueUnit}}</li>
							</ul>
						</td>
						<td>{{prodItem.billingModeName}}</td>
						<td>{{prodItem.period}}</td>
						<td>{{prodItem.quantity}}</td>
						<td style="width: 150px!important;">{{prodItem.oneTimePriceAndPrice}}</td>
						<td >{{prodItem.serviceTypeName}}</td>
						<td class="validateInfo">{{prodItem.statusName}}</td>
						<td >{{prodItem.createDate}}</td>
						<td>{{prodItem.expireDate}}
						</td>
					</tr>
				</table>
			</div>
			<fc-pagination tp={{_orderLoader.TotalPages}} (pf)="changePage($event)"></fc-pagination>
		</div>	



	<!--续订-->
	 
	<div #renewOrder class="modal fade" id="renewOrder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  	<div class="modal-dialog" role="document">
				<div class="modal-content">
				  	<div class="modal-header">
					 	<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">订单续订</h4>
				  	</div>
				 	<div class="modal-body"> 
			          <!--<account-mng-cr-local></account-mng-cr-local>
			          <order-mng-detail></order-mng-detail>-->
			           	<order-mng-renew [orderItem]="selectedOrderItem"></order-mng-renew>
	           			<!-- 订单续订 -->
					   	<div *ngIf="!_renewSetting.completed" class="OrderRenew"> 
							<div class="page-content">
								<div class="page-second-container mgb20 mgl20">
									<div class="float-left">
										<span class="float-left mgr20 mgl10 mgt5">购买时长:</span>
										<div class="float-left mgr20">
											<input class="float-left" type="text" [ngModel]="selectedPeriodTypeName" disabled="true">
											<input *ngIf="!_renewSetting.isForever" class="float-left" type="number" name="" (change)="renewValueChange()" [(ngModel)]="_renewSetting.value">
										</div>
									<button class="btn  mgr20" [ngClass]="{'fox-cloud-button-green':!_renewSetting.isForever!=1,'fox-cloud-button-white':!_renewSetting.isForever==1}" (click)="selectForever();">永&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;久</button>
								
										
									<div class="float-right">
										续订后到期时间：<span class="warnInfo">{{_renewSetting.renewDate}}</span>
									</div>	
								</div>
							</div>
					  	</div>
					</div>
			      
				  	<div *ngIf="!_renewSetting.completed" class="modal-footer" style="text-align: center;">
						<button  type="button" class="btn fox-cloud-button-green fox-cloud-button-lg " data-toggle="modal" data-target="#renewOrderOk" (click)="renew()" >确认续订</button>
		                <button type="button" class="btn fox-cloud-button-lg fox-cloud-button-white" data-dismiss="modal">取消</button>
				  	</div>

				  	<!-- 订单续订完成 -->
				  	<div *ngIf="_renewSetting.completed" class="OrderRenew"> 
							<div class="page-content">
								<div class="page-second-container mgb20">
									<div class="float-left">
										<span class="warnInfo float-left mgb20">你的订单续订已完成，可以进入管理控制台查看订单状态及使用相关资源<br>如需审批，则需要订单审批通过后，才能正式生效。</span>
								    </div>
									<div class="float-right">
										<!--<span  class="float-left">（费用合计）</span>
										<ul  class="float-left mgr20">
											<li>一次性费用：<span class="warnInfo">{{_renewSetting.onetimePrice}}</span></li>
											<li class="mgl48">费用： <span class="warnInfo">{{_renewSetting.price}}<br>
																		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;￥100/年
														</span>
											</li>
										</ul>-->
										<button class="button-size-big button-confirm pull-right" data-dismiss="modal" (click)="search()">管理控制台</button>
									</div>	
									<div style="height: 40px;"></div>
								</div>
							</div>
					 	</div>
					</div>
			      
				  	<div *ngIf="_renewSetting.completed" class="modal-footer">
						    
				  	</div>
				
		  	</div>
		</div>
	

	 </div>	